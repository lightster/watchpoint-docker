#!/bin/bash

cd $(dirname ${0})

INSTALL_TARGET=""
COMPOSE_FILES=()

case "$1" in
    pier)
        COMPOSE_FILES=(
            docker-compose.dev-ssl.yml
            docker-compose.web.yml
            docker-compose.pier.yml
        )
        INSTALL_TARGET="install-pier"
        VERSION="pickem"
        ;;

    docker-dev)
        COMPOSE_FILES=(
            docker-compose.dev-ssl.yml
            docker-compose.web.yml
        )
        INSTALL_TARGET="install-dev"
        VERSION="pickem"
        ;;

    docker-prod)
        COMPOSE_FILES=(
            docker-compose.web.yml
            docker-compose.production.yml
        )
        INSTALL_TARGET="install-docker"
        VERSION=""
        ;;

    *)
        echo "Usage: $0 pier|docker-dev|docker-prod"
        exit 1
esac

cat >Makefile <<ENV_VARS
COMPOSE_FILES=$(printf ' -f %s' "${COMPOSE_FILES[@]}")
INSTALL_TARGET=${INSTALL_TARGET}
VERSION=${VERSION}

ENV_VARS

tee -a Makefile <Makefile.in >/dev/null
